<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Generated by indoc on 24 Dec 2015 -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link href="indoc_WI.css" rel="stylesheet" type="text/css" />
<title>3.13. Locks and keys</title>
<script type="text/javascript">
    function showExtra(id, imid) {
        if (document.getElementById(id).style.display == 'block') {
            document.getElementById(id).style.display = 'none';
            document.getElementById(imid).src = 'inform:/doc_images/extra.png';
        } else {
            document.getElementById(id).style.display = 'block';
            document.getElementById(imid).src = 'inform:/doc_images/extraclose.png';
        }
    }
    function onLoaded() {
        if (window.location.hash) {
            var hash = window.location.hash.substring(2);
            if (hash.search("_") >= 0) {
                var res = hash.split("_");
                showExample("example"+res[1]);
            } else {
                showExample("example"+hash);
            }
        }
    }
    window.onload=onLoaded;
    function showExample(id) {
        if (document.getElementById(id).style.display == 'block') {
            document.getElementById(id).style.display = 'none';
        } else {
            document.getElementById(id).style.display = 'block';
        }
    }
    function openExtra(id, imid) {
        document.getElementById(id).style.display = 'block';
        document.getElementById(imid).src = 'inform:/doc_images/extraclose.png';
    }
    function closeExtra(id, imid) {
        document.getElementById(id).style.display = 'none';
        document.getElementById(imid).src = 'inform:/doc_images/extra.png';
    }
</script>
</head>
<body class="paper papertint"><script language="JavaScript">
function pasteCode(code) {
    var myProject = window.Project;

    myProject.selectView('source');
    myProject.pasteCode(code);
}
</script>
<script language="JavaScript">
function createNewProject(code, title) {
    var myProject = window.Project;

    myProject.createNewProject(title, code);
}
</script>

<!-- SEARCH TITLE "Locks and keys" -->
<!-- SEARCH SECTION "3.13" -->
<!-- SEARCH SORT "000-003-013-000" -->
<!-- START IGNORE 37 -->
<div class="bookheader">
<table class="fullwidth midnightblack"><tr><td class="midnightbannerleftcell"><a href="doc37.html" class="standardlink"><img alt="Hookleft.png" src="inform:/doc_images/Hookleft.png" id="hookleft" /></a></td><td class="midnightbannercentrecell"><a href="index.html" class="standardlink"><span class="midnightbannertext">Chapter 3: Things</span></a></td><td class="midnightbannerrightcell"><a href="index.html" class="standardlink"><img alt="Hookup.png" src="inform:/doc_images/Hookup.png" id="hookup" /></a><a href="doc39.html" class="standardlink"><img alt="Hookright.png" src="inform:/doc_images/Hookright.png" id="hookright" /></a></td></tr></table></div>
<!-- END IGNORE -->
<p class="sectionheading">ยง3.13. Locks and keys</p>
<p>It seems unwise for a door in Notting Hill to be unlocked, so:</p>
<!-- START CODE "c294" -->
<a id="c294"></a><blockquote class="code"><p class="quoted">
The blue door is lockable and locked. The matching key of the blue door is the brass Yale key.
</p></blockquote>
<!-- END CODE -->
<p>Since the second sentence here is a little clumsy, we can equivalently say</p>
<!-- START CODE "c295" -->
<a id="c295"></a><blockquote class="code"><p class="quoted">
The brass Yale key unlocks the blue door.
</p></blockquote>
<!-- END CODE -->
<p>Yet a third way to say this is:</p>
<!-- START CODE "c296" -->
<a id="c296"></a><blockquote class="code"><p class="quoted">
The blue door has matching key the brass Yale key.
</p></blockquote>
<!-- END CODE -->
<p>This introduces three new properties: a door can be locked or unlocked; lockable or not lockable; and it can have a matching key, which must be another thing. The same thing can be the matching key of many different locks: and note that a door can be locked and even lockable without having a matching key at all, in which case the player trying to open it will be permanently out of luck. Doors are ordinarily unlocked, not lockable, and without a matching key.</p>
<p>Containers can also have locks, in exactly the same way, and are allowed to have the same properties. On the other hand supporters never have locks: it makes no sense to be able to lock a tabletop, for instance, and Inform will not allow any discussion of the matching key of a supporter, or of a supporter being locked or unlocked.</p>
<hr />
<div class="bookexamples">
<p class="chapterheading"></p><!-- START EXAMPLE "23: Disenchantment Bay 6" "e390" -->
<a id="e390"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="#" class="eglink" onclick="showExample('example390'); return false;"><b>23</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="#" class="eglink" onclick="showExample('example390'); return false;"><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Disenchantment Bay 6</span></b></a><br />Disenchantment Bay: locking up the charter boat's fishing rods.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="Rdoc3.html#e390"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example390" style="display: none;">
<p>It stands to reason that the captain wouldn't let just anyone meddle with his fishing equipment; maybe he keeps that case locked. We could replace the case description with this one, instead:</p>
<!-- START CODE "c297_390" -->
<a id="c297_390"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode('The Cabin contains a glass case. In the glass case is a collection of fishing rods. The case is closed, transparent, openable, lockable, and locked. The case is scenery. The small silver key unlocks the case.[=0x000A=][=0x000A=]\n')"><img alt="paste.png" src="inform:/doc_images/paste.png" /></a> The Cabin contains a glass case. In the glass case is a collection of fishing rods. The case is closed, transparent, openable, lockable, and locked. The case is scenery. The small silver key unlocks the case.
</p></blockquote>
<!-- END CODE -->
<p>Now there's a silver key that will unlock it -- though since we haven't said where the key is, the player will never be able to find it in the game. (If we look at the World index, we find &quot;small silver key&quot; right at the bottom, not inside any of the rooms. That is as good as not existing at all -- though we usually use the term &quot;out of play&quot; -- but as we will later see, it is possible to have things initially out of play but brought into existence later on.)</p>
</div>
<p></p>
<!-- END EXAMPLE -->
<!-- START EXAMPLE "24: Neighborhood Watch" "e404" -->
<a id="e404"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="#" class="eglink" onclick="showExample('example404'); return false;"><b>24</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="#" class="eglink" onclick="showExample('example404'); return false;"><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Neighborhood Watch</span></b></a><br />A locked door that can be locked or unlocked without a key from one side, but not from the other.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="Rdoc12.html#e404"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example404" style="display: none;">
<p>Suppose we want a locked door that can be opened with a key, but is also openable by hand without a key from one side only. We start by defining an ordinary lockable door and the key that controls it:</p>
<!-- START CODE "c298_404" -->
<a id="c298_404"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode('[=0x0022=]Neighborhood Watch[=0x0022=][=0x000A=][=0x000A=]The shabby door is a door. It is outside from the Studio Apartment and inside from the Rickety Stairwell. The shabby door is locked.[=0x000A=][=0x000A=]The brass key is carried by the player. It unlocks the shabby door.[=0x000A=][=0x000A=][The next part is going to require that we modify the normal operation of the [=0x0022=]lock[=0x0022=] command. [=0x0022=]Lock[=0x0022=] ordinarily requires that the player supply two objects: a thing he wants to unlock, and the key he wants to use on it. The full command is LOCK DOOR WITH THE KEY, and Inform will not accept simply LOCK DOOR as locking.][=0x000A=][=0x000A=][Therefore, we[=0x0027=]re going to need to create our own new variant on the lock verb (and the unlock verb, while we[=0x0027=]re at it). The full procedure for this is laid out in the chapters on Action and Understanding, but here is an example:][=0x000A=][=0x000A=]Understand [=0x0022=]lock [something][=0x0022=] as locking keylessly. Locking keylessly is an action applying to one thing.[=0x000A=][=0x000A=][Here we[=0x0027=]ve created a new action -- locking something without a key -- and we[=0x0027=]ve told Inform to understand LOCK DOOR as this action, rather than an incomplete command to LOCK DOOR WITH SOMETHING.][=0x000A=][=0x000A=][Now we add some instructions so that the game will not let us use this keyless unlocking command unless we[=0x0027=]re in the right place or are properly equipped:][=0x000A=][=0x000A=]Check locking keylessly:[=0x000A=][=0x0009=]if the noun is not a door, say [=0x0022=][The noun] is not something you can lock.[=0x0022=] instead;[=0x000A=][=0x0009=]if the noun is locked, say [=0x0022=][The noun] is already locked.[=0x0022=] instead;[=0x000A=][=0x0009=]if the player carries the brass key and the player is in the Stairwell, try locking the noun with the brass key instead;[=0x000A=][=0x0009=]if the player is in the Stairwell, say [=0x0022=]You can[=0x0027=]t lock the door from this side without the key.[=0x0022=] instead.[=0x000A=][=0x000A=][This check rule is performed before the keyless locking action succeeds. The first thing we do is try to use the key if the player is outside and has the key: this way, LOCK DOOR will turn automatically into LOCK DOOR WITH THE KEY, under circumstances where that is both possible and necessary.][=0x000A=][=0x000A=][The second thing is to check whether the player is outside but keyless, and, if so stop the action from being performed successfully. Here we print a failure message followed by the word [=0x0022=]instead[=0x0022=], which tells Inform that we[=0x0027=]ve substituted some other outcome for the usual performance of the action.][=0x000A=][=0x000A=][Now we[=0x0027=]re reasonably sure that the player is only locking keylessly in the case that he is inside the Studio. (We might have to do a more thorough check for this if there were more than two rooms, but as it is, the player can only be in the Stairwell or in the Studio, so if we have ruled out the Stairwell, we are safe.) So now we want to add what happens when locking-without-a-key command succeeds:][=0x000A=][=0x000A=]Carry out locking keylessly:[=0x000A=][=0x0009=]now the noun is locked.[=0x000A=][=0x000A=][That[=0x0027=]s it. We[=0x0027=]ve just told Inform to make the door be locked. [=0x0022=]Now...[=0x0022=] syntax will be explained more thoroughly in the chapter on change. But we still haven[=0x0027=]t described to the player what just happened, so let[=0x0027=]s provide a description of that, too:][=0x000A=][=0x000A=]Report locking keylessly:[=0x000A=][=0x0009=]say [=0x0022=]You flip over the deadbolt to lock [the noun].[=0x0022=][=0x000A=][=0x000A=][And now we have to do a similar set of things for unlocking:][=0x000A=][=0x000A=]Understand [=0x0022=]unlock [something][=0x0022=] as unlocking keylessly. Unlocking keylessly is an action applying to one thing.[=0x000A=][=0x000A=]Check unlocking keylessly:[=0x000A=][=0x0009=]if the noun is not a door, say [=0x0022=][The noun] is not something you can lock.[=0x0022=] instead;[=0x000A=][=0x0009=]if the noun is unlocked, say [=0x0022=][The noun] is already unlocked.[=0x0022=] instead;[=0x000A=][=0x0009=]if the player carries the brass key and the player is in the Stairwell, try unlocking the noun with the brass key instead;[=0x000A=][=0x0009=]if the player is in the Stairwell, say [=0x0022=]You can[=0x0027=]t unlock the door from this side without the key.[=0x0022=] instead.[=0x000A=][=0x000A=]Carry out unlocking keylessly:[=0x000A=][=0x0009=]now the noun is unlocked.[=0x000A=][=0x000A=]Report unlocking keylessly:[=0x000A=][=0x0009=]say [=0x0022=]You flip over the deadbolt to unlock [the noun].[=0x0022=][=0x000A=][=0x000A=]Test me with [=0x0022=]unlock door / drop key / open door / out / close door / lock door / open door / in / get key / out / close door / lock door / unlock door[=0x0022=].[=0x000A=][=0x000A=]\n')"><img alt="paste.png" src="inform:/doc_images/paste.png" /></a> &quot;Neighborhood Watch&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c299_404" -->
<a id="c299_404"></a><blockquote class="code"><p class="quoted">
The shabby door is a door. It is outside from the Studio Apartment and inside from the Rickety Stairwell. The shabby door is locked.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c300_404" -->
<a id="c300_404"></a><blockquote class="code"><p class="quoted">
The brass key is carried by the player. It unlocks the shabby door.
</p></blockquote>
<!-- END CODE -->
<p>The next part is going to require that we modify the normal operation of the &quot;lock&quot; command. &quot;Lock&quot; ordinarily requires that the player supply two objects: a thing he wants to unlock, and the key he wants to use on it. The full command is LOCK DOOR WITH THE KEY, and Inform will not accept simply LOCK DOOR as locking.</p>
<p>Therefore, we're going to need to create our own new variant on the lock verb (and the unlock verb, while we're at it). The full procedure for this is laid out in the chapters on Action and Understanding, but here is an example:</p>
<!-- START CODE "c301_404" -->
<a id="c301_404"></a><blockquote class="code"><p class="quoted">
Understand &quot;lock [something]&quot; as locking keylessly. Locking keylessly is an action applying to one thing.
</p></blockquote>
<!-- END CODE -->
<p>Here we've created a new action -- locking something without a key -- and we've told Inform to understand LOCK DOOR as this action, rather than an incomplete command to LOCK DOOR WITH SOMETHING.</p>
<p>Now we add some instructions so that the game will not let us use this keyless unlocking command unless we're in the right place or are properly equipped:</p>
<!-- START CODE "c302_404" -->
<a id="c302_404"></a><blockquote class="code"><p class="quoted">
Check locking keylessly:
<br />&#160;&#160;&#160;&#160;if the noun is not a door, say &quot;[The noun] is not something you can lock.&quot; instead;
<br />&#160;&#160;&#160;&#160;if the noun is locked, say &quot;[The noun] is already locked.&quot; instead;
<br />&#160;&#160;&#160;&#160;if the player carries the brass key and the player is in the Stairwell, try locking the noun with the brass key instead;
<br />&#160;&#160;&#160;&#160;if the player is in the Stairwell, say &quot;You can't lock the door from this side without the key.&quot; instead.
</p></blockquote>
<!-- END CODE -->
<p>This check rule is performed before the keyless locking action succeeds. The first thing we do is try to use the key if the player is outside and has the key: this way, LOCK DOOR will turn automatically into LOCK DOOR WITH THE KEY, under circumstances where that is both possible and necessary.</p>
<p>The second thing is to check whether the player is outside but keyless, and, if so stop the action from being performed successfully. Here we print a failure message followed by the word &quot;instead&quot;, which tells Inform that we've substituted some other outcome for the usual performance of the action.</p>
<p>Now we're reasonably sure that the player is only locking keylessly in the case that he is inside the Studio. (We might have to do a more thorough check for this if there were more than two rooms, but as it is, the player can only be in the Stairwell or in the Studio, so if we have ruled out the Stairwell, we are safe.) So now we want to add what happens when locking-without-a-key command succeeds:</p>
<!-- START CODE "c303_404" -->
<a id="c303_404"></a><blockquote class="code"><p class="quoted">
Carry out locking keylessly:
<br />&#160;&#160;&#160;&#160;now the noun is locked.
</p></blockquote>
<!-- END CODE -->
<p>That's it. We've just told Inform to make the door be locked. &quot;Now...&quot; syntax will be explained more thoroughly in the chapter on change. But we still haven't described to the player what just happened, so let's provide a description of that, too:</p>
<!-- START CODE "c304_404" -->
<a id="c304_404"></a><blockquote class="code"><p class="quoted">
Report locking keylessly:
<br />&#160;&#160;&#160;&#160;say &quot;You flip over the deadbolt to lock [the noun].&quot;
</p></blockquote>
<!-- END CODE -->
<p>And now we have to do a similar set of things for unlocking:</p>
<!-- START CODE "c305_404" -->
<a id="c305_404"></a><blockquote class="code"><p class="quoted">
Understand &quot;unlock [something]&quot; as unlocking keylessly. Unlocking keylessly is an action applying to one thing.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c306_404" -->
<a id="c306_404"></a><blockquote class="code"><p class="quoted">
Check unlocking keylessly:
<br />&#160;&#160;&#160;&#160;if the noun is not a door, say &quot;[The noun] is not something you can lock.&quot; instead;
<br />&#160;&#160;&#160;&#160;if the noun is unlocked, say &quot;[The noun] is already unlocked.&quot; instead;
<br />&#160;&#160;&#160;&#160;if the player carries the brass key and the player is in the Stairwell, try unlocking the noun with the brass key instead;
<br />&#160;&#160;&#160;&#160;if the player is in the Stairwell, say &quot;You can't unlock the door from this side without the key.&quot; instead.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c307_404" -->
<a id="c307_404"></a><blockquote class="code"><p class="quoted">
Carry out unlocking keylessly:
<br />&#160;&#160;&#160;&#160;now the noun is unlocked.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c308_404" -->
<a id="c308_404"></a><blockquote class="code"><p class="quoted">
Report unlocking keylessly:
<br />&#160;&#160;&#160;&#160;say &quot;You flip over the deadbolt to unlock [the noun].&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c309_404" -->
<a id="c309_404"></a><blockquote class="code"><p class="quoted">
Test me with &quot;unlock door / drop key / open door / out / close door / lock door / open door / in / get key / out / close door / lock door / unlock door&quot;.
</p></blockquote>
<!-- END CODE -->
<p>Some (but not all) of this work is done for you if you like by the Locksmith extension. If you prefer, you can include that extension, then follow the documentation in order to implement the remainder of the scenario. Locksmith takes care of implementing the additional locking and unlocking actions, and provides some other conveniences.</p>
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
</div>
<!-- START IGNORE -->
<div class="bookfooter">
<table class="fullwidth"><tr><td class="footerprevious"><a href="doc37.html" class="footerlink">Previous</a></td><td class="footercontents"><a href="index.html" class="footerlink">Contents</a></td><td class="footernext"><a href="doc39.html" class="footerlink">Next</a></td></tr></table>
</div>
<!-- END IGNORE -->
</body>
</html>
