<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Generated by indoc on 24 Dec 2015 -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link href="indoc_WI.css" rel="stylesheet" type="text/css" />
<title>20.8. Replacements</title>
<script type="text/javascript">
    function showExtra(id, imid) {
        if (document.getElementById(id).style.display == 'block') {
            document.getElementById(id).style.display = 'none';
            document.getElementById(imid).src = 'inform:/doc_images/extra.png';
        } else {
            document.getElementById(id).style.display = 'block';
            document.getElementById(imid).src = 'inform:/doc_images/extraclose.png';
        }
    }
    function onLoaded() {
        if (window.location.hash) {
            var hash = window.location.hash.substring(2);
            if (hash.search("_") >= 0) {
                var res = hash.split("_");
                showExample("example"+res[1]);
            } else {
                showExample("example"+hash);
            }
        }
    }
    window.onload=onLoaded;
    function showExample(id) {
        if (document.getElementById(id).style.display == 'block') {
            document.getElementById(id).style.display = 'none';
        } else {
            document.getElementById(id).style.display = 'block';
        }
    }
    function openExtra(id, imid) {
        document.getElementById(id).style.display = 'block';
        document.getElementById(imid).src = 'inform:/doc_images/extraclose.png';
    }
    function closeExtra(id, imid) {
        document.getElementById(id).style.display = 'none';
        document.getElementById(imid).src = 'inform:/doc_images/extra.png';
    }
</script>
</head>
<body class="paper papertint"><script language="JavaScript">
function pasteCode(code) {
    var myProject = window.Project;

    myProject.selectView('source');
    myProject.pasteCode(code);
}
</script>
<script language="JavaScript">
function createNewProject(code, title) {
    var myProject = window.Project;

    myProject.createNewProject(title, code);
}
</script>

<!-- SEARCH TITLE "Replacements" -->
<!-- SEARCH SECTION "20.8" -->
<!-- SEARCH SORT "000-020-008-000" -->
<!-- START IGNORE 349 -->
<div class="bookheader">
<table class="fullwidth midnightblack"><tr><td class="midnightbannerleftcell"><a href="doc349.html" class="standardlink"><img alt="Hookleft.png" src="inform:/doc_images/Hookleft.png" id="hookleft" /></a></td><td class="midnightbannercentrecell"><a href="index.html" class="standardlink"><span class="midnightbannertext">Chapter 20: Advanced Text</span></a></td><td class="midnightbannerrightcell"><a href="index.html" class="standardlink"><img alt="Hookup.png" src="inform:/doc_images/Hookup.png" id="hookup" /></a><a href="doc351.html" class="standardlink"><img alt="Hookright.png" src="inform:/doc_images/Hookright.png" id="hookright" /></a></td></tr></table></div>
<!-- END IGNORE -->
<p class="sectionheading">ยง20.8. Replacements</p>
<p>Suppose V is a text which varies - perhaps a property of something, or a variable defined everywhere, or a temporary &quot;let&quot;-named value. How do we change its contents? The easiest way is simply to assign text to it. Thus:</p>
<!-- START CODE "c8259" -->
<a id="c8259"></a><blockquote class="code"><p class="quoted">
let V be &quot;It is now [the time of the day in words].&quot;
</p></blockquote>
<!-- END CODE -->
<p>And, for instance,</p>
<!-- START CODE "c8260" -->
<a id="c8260"></a><blockquote class="code"><p class="quoted">
let V be &quot;[V]!&quot;
</p></blockquote>
<!-- END CODE -->
<p>adds an exclamation mark at the end of V.</p>
<p>Otherwise, it is more useful (also a little faster) to modify V by changing its characters, words and so on. Thus:</p>
<!-- START PHRASE "defn314" -->
<div class="definition"><a id="defn314"></a><p class="defnprototype"><b>replace character number </b>(number)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replacechar -->

<p>This phrase acts on the named text by placing the given text in place of the Nth character, counting from 1. Example:</p>
<!-- START CODE "c8261" -->
<a id="c8261"></a><blockquote class="code"><p class="quoted">
let V be &quot;mope&quot;;
<br />replace character number 3 in V with &quot;lecul&quot;;
<br />say V;
</p></blockquote>
<!-- END CODE -->
<p>says &quot;molecule&quot;.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn315" -->
<div class="definition"><a id="defn315"></a><p class="defnprototype"><b>replace word number </b>(number)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replaceword -->

<p>This phrase acts on the named text by placing the given text in place of the Nth word, counting from 1, and dividing words at spacing or punctuation. Example:</p>
<!-- START CODE "c8262" -->
<a id="c8262"></a><blockquote class="code"><p class="quoted">
let V be &quot;Does the well run dry?&quot;;
<br />replace word number 3 in V with &quot;jogger&quot;;
<br />say V;
</p></blockquote>
<!-- END CODE -->
<p>says &quot;Does the jogger run dry?&quot;.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn316" -->
<div class="definition"><a id="defn316"></a><p class="defnprototype"><b>replace punctuated word number </b>(number)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replacepword -->

<p>This phrase acts on the named text by placing the given text in place of the Nth word, counting from 1, and dividing words at spacing, counting punctuation runs as words in their own right. Example:</p>
<!-- START CODE "c8263" -->
<a id="c8263"></a><blockquote class="code"><p class="quoted">
let V be &quot;Frankly, yes, I agree.&quot;;
<br />replace punctuated word number 2 in V with &quot;:&quot;;
<br />say V;
</p></blockquote>
<!-- END CODE -->
<p>says &quot;Frankly: yes, I agree.&quot;.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn317" -->
<div class="definition"><a id="defn317"></a><p class="defnprototype"><b>replace unpunctuated word number </b>(number)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replaceupword -->

<p>This phrase acts on the named text by placing the given text in place of the Nth word, counting from 1, and dividing words at spacing, counting punctuation as part of a word just as if it were lettering. Example:</p>
<!-- START CODE "c8264" -->
<a id="c8264"></a><blockquote class="code"><p class="quoted">
let V be &quot;Frankly, yes, I agree.&quot;;
<br />replace unpunctuated word number 2 in V with &quot;of course&quot;;
<br />say V;
</p></blockquote>
<!-- END CODE -->
<p>says &quot;Frankly, of course I agree.&quot;.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn318" -->
<div class="definition"><a id="defn318"></a><p class="defnprototype"><b>replace line number </b>(number)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replaceline -->

<p>This phrase acts on the named text by placing the given text in place of the Nth line, counting from 1. Lines are divided by paragraph or line breaks.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn319" -->
<div class="definition"><a id="defn319"></a><p class="defnprototype"><b>replace paragraph number </b>(number)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replacepara -->

<p>This phrase acts on the named text by placing the given text in place of the Nth paragraph, counting from 1.</p>

<!-- end definition -->
</div>

<p>Last, but not least, we can replace text wherever it occurs:</p>
<!-- START PHRASE "defn320" -->
<div class="definition"><a id="defn320"></a><p class="defnprototype"><b>replace the text </b>(text)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replace -->

<p>This phrase acts on the named text by searching and replacing, as many non-overlapping times as possible. Example:</p>
<!-- START CODE "c8265" -->
<a id="c8265"></a><blockquote class="code"><p class="quoted">
replace the text &quot;a&quot; in V with &quot;z&quot;
</p></blockquote>
<!-- END CODE -->
<p>changes every lower-case &quot;a&quot; to &quot;z&quot;: the same thing done with the &quot;case insensitively&quot; option would change each &quot;a&quot; or &quot;A&quot; to &quot;z&quot;.</p>

<!-- end definition -->
</div>

<p>All very well for letters, but it can be unfortunate to try</p>
<!-- START CODE "c8266" -->
<a id="c8266"></a><blockquote class="code"><p class="quoted">
replace the text &quot;Bob&quot; in V with &quot;Robert&quot;
</p></blockquote>
<!-- END CODE -->
<p>if V happens to contain, say &quot;The Olympic Bobsleigh Team&quot;: it would become &quot;The Olympic Robertsleigh Team&quot;. What we want, of course, is for Bob to become Robert only when it's a whole word. We can get that with:</p>
<!-- START PHRASE "defn321" -->
<div class="definition"><a id="defn321"></a><p class="defnprototype"><b>replace the word </b>(text)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replacewordin -->

<p>This phrase acts on the named text by searching and replacing, as many non-overlapping times as possible, where the search text must occur as a whole word. Example:</p>
<!-- START CODE "c8267" -->
<a id="c8267"></a><blockquote class="code"><p class="quoted">
replace the word &quot;Bob&quot; in V with &quot;Robert&quot;
</p></blockquote>
<!-- END CODE -->
<p>changes &quot;Bob got on the Bobsleigh&quot; to &quot;Robert got on the Bobsleigh&quot;.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn322" -->
<div class="definition"><a id="defn322"></a><p class="defnprototype"><b>replace the punctuated word </b>(text)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replacepwordin -->

<p>This phrase acts on the named text by searching and replacing, as many non-overlapping times as possible, where the search text must occur as a whole word or run of punctuation.</p>

<!-- end definition -->
</div>

<p>But these are all just special cases of the grand-daddy of all replacement phrases:</p>
<!-- START PHRASE "defn323" -->
<div class="definition"><a id="defn323"></a><p class="defnprototype"><b>replace the regular expression </b>(text)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replacere -->

<p>This phrase acts on the named text by matching the regular expression and replacing anything which fits it, as many non-overlapping times as possible. Example:</p>
<!-- START CODE "c8268" -->
<a id="c8268"></a><blockquote class="code"><p class="quoted">
replace the regular expression &quot;\d+&quot; in V with &quot;...&quot;
</p></blockquote>
<!-- END CODE -->
<p>changes &quot;The Battle of Waterloo, 1815, rivalled Trafalgar, 1805&quot; to &quot;The Battle of Waterloo, ..., rivalled Trafalgar, ...&quot;. The &quot;case insensitively&quot; causes lower and upper case letters to be treated as if the same letter.</p>
<p>When replacing a regular expression, the replacement text also has a few special meanings (though, thankfully, many fewer than for the expression itself). Once again &quot;\n&quot; and &quot;\t&quot; can be used for line break and tab characters, and &quot;\\&quot; must be used for an actual backslash. But, very usefully, &quot;\1&quot; to &quot;\9&quot; expand as the contents of groups numbered 1 to 9, and &quot;\0&quot; to the exact text matched. So:</p>
<!-- START CODE "c8269" -->
<a id="c8269"></a><blockquote class="code"><p class="quoted">
replace the regular expression &quot;\d+&quot; in V with &quot;roughly \0&quot;
</p></blockquote>
<!-- END CODE -->
<p>adds the word &quot;roughly&quot; in front of any run of digits in V, because \0 becomes in turn whichever run of digits matched. And</p>
<!-- START CODE "c8270" -->
<a id="c8270"></a><blockquote class="code"><p class="quoted">
replace the regular expression &quot;(\w+) (.*)&quot; in V with &quot;\2, \1&quot;
</p></blockquote>
<!-- END CODE -->
<p>performs the transformation &quot;Frank Booth&quot; to &quot;Booth, Frank&quot;.</p>
<p>Finally, prefixing the number by &quot;l&quot; or &quot;u&quot; forces the text it represents into lower or upper case, respectively. For instance:</p>
<!-- START CODE "c8271" -->
<a id="c8271"></a><blockquote class="code"><p class="quoted">
replace the regular expression &quot;\b(\w)(\w*)&quot; in X with &quot;\u1\l2&quot;;
</p></blockquote>
<!-- END CODE -->
<p>changes the casing of X to &quot;title casing&quot;, where each individual word is capitalised. (This is a little slow on large texts, since so many matches and replacements are made: it's more efficient to use the official phrases for changing case.)</p>

<!-- end definition -->
</div>

<hr />
<div class="bookexamples">
<p class="chapterheading"></p><!-- START EXAMPLE "419: Igpay Atinlay" "e111" -->
<a id="e111"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="#" class="eglink" onclick="showExample('example111'); return false;"><b>419</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="#" class="eglink" onclick="showExample('example111'); return false;"><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Igpay Atinlay</span></b></a><br />A pig Latin filter for the player's commands.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="Rdoc7.html#e111"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example111" style="display: none;">
<p>For the sake of argument, suppose we want to parrot back all the player's commands in pig Latin:</p>
<!-- START CODE "c8272_111" -->
<a id="c8272_111"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode(' [=0x0022=]Igpay Atinlay[=0x0022=][=0x000A=][=0x000A=]Armfay is a room.[=0x000A=][=0x000A=]After reading a command:[=0x000A=][=0x0009=]let N be [=0x0022=][the player[=0x0027=]s command][=0x0022=];[=0x000A=][=0x0009=]replace the regular expression [=0x0022=][=0x005C=]b([=0x003C=]aeiou[=0x003E=]+)([=0x005C=]w*)[=0x0022=] in N with [=0x0022=][=0x005C=]1[=0x005C=]2ay[=0x0022=];[=0x000A=][=0x0009=]replace the regular expression [=0x0022=][=0x005C=]b([=0x003C=]bcdfghjklmnpqrstvwxz[=0x003E=]+)([=0x005C=]w*)[=0x0022=] in N with [=0x0022=][=0x005C=]2[=0x005C=]1ay[=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=][N][paragraph break][=0x0022=];[=0x000A=][=0x0009=]reject the player[=0x0027=]s command.[=0x000A=][=0x000A=]Test me with [=0x0022=]nix on the stupid[=0x0022=].[=0x000A=]\n')"><img alt="paste.png" src="inform:/doc_images/paste.png" /></a>  &quot;Igpay Atinlay&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8273_111" -->
<a id="c8273_111"></a><blockquote class="code"><p class="quoted">
Armfay is a room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8274_111" -->
<a id="c8274_111"></a><blockquote class="code"><p class="quoted">
After reading a command:
<br />&#160;&#160;&#160;&#160;let N be &quot;[the player's command]&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;\b(&lt;aeiou&gt;+)(\w*)&quot; in N with &quot;\1\2ay&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;\b(&lt;bcdfghjklmnpqrstvwxz&gt;+)(\w*)&quot; in N with &quot;\2\1ay&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[N][paragraph break]&quot;;
<br />&#160;&#160;&#160;&#160;reject the player's command.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8275_111" -->
<a id="c8275_111"></a><blockquote class="code"><p class="quoted">
Test me with &quot;nix on the stupid&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<!-- START EXAMPLE "420: Fido" "e185" -->
<a id="e185"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="#" class="eglink" onclick="showExample('example185'); return false;"><b>420</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="#" class="eglink" onclick="showExample('example185'); return false;"><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Fido</span></b></a><br />A dog the player can name and un-name at will.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="Rdoc65.html#e185"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example185" style="display: none;">
<p>Suppose we'd like to have a dog which the player is allowed to name himself. We'd like to deal correctly with both</p>
<!-- START CODE "c8276_185" -->
<a id="c8276_185"></a><blockquote class="code"><p class="quoted">
&gt;name the dog fido
</p></blockquote>
<!-- END CODE -->
<p>and</p>
<!-- START CODE "c8277_185" -->
<a id="c8277_185"></a><blockquote class="code"><p class="quoted">
&gt;name the dog &quot;fido&quot;
</p></blockquote>
<!-- END CODE -->
<p>so we'll also need to strip quotation marks out of the command. We can do this as follows:</p>
<!-- START CODE "c8278_185" -->
<a id="c8278_185"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode(' [=0x0022=]Fido[=0x0022=][=0x000A=][=0x000A=]The Back Yard is a room.[=0x000A=][=0x000A=]A dog is an animal in Back Yard. The dog has some text called the nickname. The nickname of the dog is [=0x0022=]nothing[=0x0022=]. Understand the nickname property as describing the dog.[=0x000A=][=0x000A=]Rule for printing the name of the dog when the nickname of the dog is not [=0x0022=]nothing[=0x0022=]:[=0x000A=][=0x0009=]say [=0x0022=][nickname of the dog][=0x0022=][=0x000A=][=0x000A=]Naming it with is an action applying to one thing and one topic. Understand [=0x0022=]name [something] [text][=0x0022=] as naming it with. Check naming it with: say [=0x0022=]You can[=0x0027=]t name that.[=0x0022=][=0x000A=][=0x000A=]Instead of naming the dog with [=0x0022=]nothing[=0x0022=]:[=0x000A=][=0x0009=]now the nickname of the dog is [=0x0022=]nothing[=0x0022=];[=0x000A=][=0x0009=]now the dog is improper-named;[=0x000A=][=0x0009=]say [=0x0022=]You revoke your choice of dog-name.[=0x0022=][=0x000A=][=0x000A=]Instead of naming the dog with something:[=0x000A=][=0x0009=]let N be [=0x0022=][the topic understood][=0x0022=];[=0x000A=][=0x0009=]replace the text [=0x0022=][=0x0027=][=0x0022=] in N with [=0x0022=][=0x0022=];[=0x000A=][=0x0009=]now the nickname of the dog is [=0x0022=][N][=0x0022=];[=0x000A=][=0x0009=]now the dog is proper-named;[=0x000A=][=0x0009=]say [=0x0022=]The dog is now known as [nickname of the dog].[=0x0022=][=0x000A=][=0x000A=]Test me with [=0x0022=]name the dog Fido / name the dog Lawrence / look / x lawrence / name Lawrence nothing / look / x lawrence[=0x0022=].[=0x000A=]\n')"><img alt="paste.png" src="inform:/doc_images/paste.png" /></a>  &quot;Fido&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8279_185" -->
<a id="c8279_185"></a><blockquote class="code"><p class="quoted">
The Back Yard is a room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8280_185" -->
<a id="c8280_185"></a><blockquote class="code"><p class="quoted">
A dog is an animal in Back Yard. The dog has some text called the nickname. The nickname of the dog is &quot;nothing&quot;. Understand the nickname property as describing the dog.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8281_185" -->
<a id="c8281_185"></a><blockquote class="code"><p class="quoted">
Rule for printing the name of the dog when the nickname of the dog is not &quot;nothing&quot;:
<br />&#160;&#160;&#160;&#160;say &quot;[nickname of the dog]&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8282_185" -->
<a id="c8282_185"></a><blockquote class="code"><p class="quoted">
Naming it with is an action applying to one thing and one topic. Understand &quot;name [something] [text]&quot; as naming it with. Check naming it with: say &quot;You can't name that.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8283_185" -->
<a id="c8283_185"></a><blockquote class="code"><p class="quoted">
Instead of naming the dog with &quot;nothing&quot;:
<br />&#160;&#160;&#160;&#160;now the nickname of the dog is &quot;nothing&quot;;
<br />&#160;&#160;&#160;&#160;now the dog is improper-named;
<br />&#160;&#160;&#160;&#160;say &quot;You revoke your choice of dog-name.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8284_185" -->
<a id="c8284_185"></a><blockquote class="code"><p class="quoted">
Instead of naming the dog with something:
<br />&#160;&#160;&#160;&#160;let N be &quot;[the topic understood]&quot;;
<br />&#160;&#160;&#160;&#160;replace the text &quot;'&quot; in N with &quot;&quot;;
<br />&#160;&#160;&#160;&#160;now the nickname of the dog is &quot;[N]&quot;;
<br />&#160;&#160;&#160;&#160;now the dog is proper-named;
<br />&#160;&#160;&#160;&#160;say &quot;The dog is now known as [nickname of the dog].&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8285_185" -->
<a id="c8285_185"></a><blockquote class="code"><p class="quoted">
Test me with &quot;name the dog Fido / name the dog Lawrence / look / x lawrence / name Lawrence nothing / look / x lawrence&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<!-- START EXAMPLE "421: Blackout" "e384" -->
<a id="e384"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="#" class="eglink" onclick="showExample('example384'); return false;"><b>421</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="#" class="eglink" onclick="showExample('example384'); return false;"><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Blackout</span></b></a><br />Filtering the names of rooms printed while in darkness.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="Rdoc5.html#e384"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example384" style="display: none;">
<p>In this example, we want the names of rooms to be asterisked out if the player wanders around without the benefit of a candle. We can do this by treating the room names as text, then replacing every letter:</p>
<!-- START CODE "c8286_384" -->
<a id="c8286_384"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode(' [=0x0022=]Blackout[=0x0022=][=0x000A=][=0x000A=]Tiny Room is a dark room. Absurdly Long-Named Room is a dark room. It is west of Tiny Room.[=0x000A=][=0x000A=]The Candle Factory is north of Tiny Room. It contains a beeswax candle. The beeswax candle is lit.[=0x000A=][=0x000A=]Rule for printing the name of a dark room:[=0x000A=][=0x0009=]let N be [=0x0022=][location][=0x0022=];[=0x000A=][=0x0009=]replace the regular expression [=0x0022=][=0x005C=]w[=0x0022=] in N with [=0x0022=]*[=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=][N][=0x0022=].[=0x000A=][=0x000A=]Test me with [=0x0022=]w / look / e / n / get candle / s / w[=0x0022=].[=0x000A=][=0x000A=]\n')"><img alt="paste.png" src="inform:/doc_images/paste.png" /></a>  &quot;Blackout&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8287_384" -->
<a id="c8287_384"></a><blockquote class="code"><p class="quoted">
Tiny Room is a dark room. Absurdly Long-Named Room is a dark room. It is west of Tiny Room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8288_384" -->
<a id="c8288_384"></a><blockquote class="code"><p class="quoted">
The Candle Factory is north of Tiny Room. It contains a beeswax candle. The beeswax candle is lit.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8289_384" -->
<a id="c8289_384"></a><blockquote class="code"><p class="quoted">
Rule for printing the name of a dark room:
<br />&#160;&#160;&#160;&#160;let N be &quot;[location]&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;\w&quot; in N with &quot;*&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[N]&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8290_384" -->
<a id="c8290_384"></a><blockquote class="code"><p class="quoted">
Test me with &quot;w / look / e / n / get candle / s / w&quot;.
</p></blockquote>
<!-- END CODE -->
<p>Notice that the hyphen in the Absurdly Long-Named Room does not get replaced. We could replace even that, if we liked, with</p>
<!-- START CODE "c8291_384" -->
<a id="c8291_384"></a><blockquote class="code"><p class="quoted">
&#160;&#160;&#160;&#160;replace the regular expression &quot;\S&quot; in N with &quot;*&quot;;
</p></blockquote>
<!-- END CODE -->
<p>which would catch every character that is not a space.</p>
</div>
<p></p>
<!-- END EXAMPLE -->
<!-- START EXAMPLE "422: Northstar" "e76" -->
<a id="e76"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="#" class="eglink" onclick="showExample('example76'); return false;"><b>422</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="#" class="eglink" onclick="showExample('example76'); return false;"><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Northstar</span></b></a><br />Making Inform understand ASK JOSH TO TAKE INVENTORY as JOSH, TAKE INVENTORY. This requires us to use a regular expression on the player's command, replacing some of the content.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="Rdoc60.html#e76"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example76" style="display: none;">
<p>Most of the time, Inform understands commands to other characters when they take the form &quot;JOSH, TAKE INVENTORY&quot; or &quot;JOAN, WEAR THE ARMOR&quot;. But novice players might also try commands of the form ASK JOSH TO TAKE INVENTORY or ORDER JOAN TO WEAR THE ARMOR.</p>
<p>The easiest way to make Inform understand such commands is to meddle directly with the player's command, changing it into the format that the game will understand, as here:</p>
<!-- START CODE "c8292_76" -->
<a id="c8292_76"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode('[=0x0022=]Northstar[=0x0022=][=0x000A=][=0x000A=]The Northstar Cafe is a room. [=0x0022=]The Northstar is crammed with its usual brunch crowd, and you were lucky to get a table at all. You are now awaiting the arrival of your ricotta pancakes.[=0x0022=][=0x000A=][=0x000A=]Josh is a man in The Northstar Cafe. [=0x0022=]Josh is on his way past your table.[=0x0022=] The description of Josh is [=0x0022=]He is a waiter here, but you also know him socially, so he tends to be more chatty than the other waiters.[=0x0022=] A persuasion rule: persuasion succeeds.[=0x000A=][=0x000A=]After reading a command:[=0x000A=][=0x0009=]let N be [=0x0022=][the player[=0x0027=]s command][=0x0022=];[=0x000A=][=0x0009=]replace the regular expression [=0x0022=][=0x005C=]b(ask|tell|order) (.+?) to (.+)[=0x0022=] in N with [=0x0022=][=0x005C=]2, [=0x005C=]3[=0x0022=];[=0x000A=][=0x0009=]change the text of the player[=0x0027=]s command to N.[=0x000A=][=0x000A=]Test me with [=0x0022=]ask Josh to take inventory / tell Josh to take inventory / order Josh to take inventory[=0x0022=].[=0x000A=][=0x000A=]\n')"><img alt="paste.png" src="inform:/doc_images/paste.png" /></a> &quot;Northstar&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8293_76" -->
<a id="c8293_76"></a><blockquote class="code"><p class="quoted">
The Northstar Cafe is a room. &quot;The Northstar is crammed with its usual brunch crowd, and you were lucky to get a table at all. You are now awaiting the arrival of your ricotta pancakes.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8294_76" -->
<a id="c8294_76"></a><blockquote class="code"><p class="quoted">
Josh is a man in The Northstar Cafe. &quot;Josh is on his way past your table.&quot; The description of Josh is &quot;He is a waiter here, but you also know him socially, so he tends to be more chatty than the other waiters.&quot; A persuasion rule: persuasion succeeds.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8295_76" -->
<a id="c8295_76"></a><blockquote class="code"><p class="quoted">
After reading a command:
<br />&#160;&#160;&#160;&#160;let N be &quot;[the player's command]&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;\b(ask|tell|order) (.+?) to (.+)&quot; in N with &quot;\2, \3&quot;;
<br />&#160;&#160;&#160;&#160;change the text of the player's command to N.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8296_76" -->
<a id="c8296_76"></a><blockquote class="code"><p class="quoted">
Test me with &quot;ask Josh to take inventory / tell Josh to take inventory / order Josh to take inventory&quot;.
</p></blockquote>
<!-- END CODE -->
<p>Note that we have to copy N back explicitly to replace the player's command.</p>
</div>
<p></p>
<!-- END EXAMPLE -->
<!-- START EXAMPLE "423: Mr. Burns' Repast" "e296" -->
<a id="e296"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="#" class="eglink" onclick="showExample('example296'); return false;"><b>423</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="#" class="eglink" onclick="showExample('example296'); return false;"><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Mr. Burns' Repast</span></b></a><br />Letting the player guess types for an unidentifiable fish.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="Rdoc7.html#e296"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example296" style="display: none;">
<p>Suppose we have an unhappily mutated fish that the player can refer to by any of a number of species names, or any word followed by -fish. We want to reject these commands, but preserve a memory of what the player last tried to call the thing:</p>
<!-- START CODE "c8297_296" -->
<a id="c8297_296"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode(' [=0x0022=]Mr. Burns[=0x0027=] Repast[=0x0022=][=0x000A=][=0x000A=]Wharf is a room.[=0x000A=][=0x000A=]There is an unknown fish in the Wharf. The unknown fish has some a text called the supposed name. The description of the unknown fish is [=0x0022=]The victim of heavy mutagens, this thing is not really recognizable as any species you know.[=0x0022=].[=0x000A=][=0x000A=]Fish variety is a kind of value. The fish varieties are salmon, albacore, mackerel.[=0x000A=][=0x000A=]Rule for printing the name of the unknown fish:[=0x000A=][=0x0009=]if the supposed name of the unknown fish is [=0x0022=][=0x0022=], say the printed name of the unknown fish;[=0x000A=][=0x0009=]otherwise say the supposed name of the unknown fish.[=0x000A=][=0x000A=]After reading a command:[=0x000A=][=0x0009=]if the unknown fish is visible and player[=0x0027=]s command matches the regular expression [=0x0022=][=0x005C=]b[=0x005C=]w+fish[=0x0022=]:[=0x000A=][=0x0009=][=0x0009=]let N be [=0x0022=][the player[=0x0027=]s command][=0x0022=];[=0x000A=][=0x0009=][=0x0009=]replace the regular expression [=0x0022=].*(?=[=0x005C=]b[=0x005C=]w+fish)[=0x0022=] in N with [=0x0022=][=0x0022=];[=0x000A=][=0x0009=][=0x0009=]now N is [=0x0022=][N](?)[=0x0022=];[=0x000A=][=0x0009=][=0x0009=]now the supposed name of the unknown fish is N;[=0x000A=][=0x0009=][=0x0009=]respond with doubt;[=0x000A=][=0x0009=][=0x0009=]reject the player[=0x0027=]s command;[=0x000A=][=0x0009=]otherwise if the unknown fish is visible and the player[=0x0027=]s command includes [=0x0022=][fish variety][=0x0022=]:[=0x000A=][=0x0009=][=0x0009=]now supposed name of the fish is [=0x0022=][fish variety understood](?)[=0x0022=];[=0x000A=][=0x0009=][=0x0009=]respond with doubt;[=0x000A=][=0x0009=][=0x0009=]reject the player[=0x0027=]s command.[=0x000A=][=0x000A=]To respond with doubt:[=0x000A=][=0x0009=]say [=0x0022=]You[=0x0027=]re not [italic type]sure[roman type] you[=0x0027=]re seeing any such thing.[=0x0022=][=0x000A=][=0x000A=]Test me with [=0x0022=]get swordfish / look / touch monkfish / look / listen to tunafish / x fish / x salmon / look[=0x0022=].[=0x000A=]\n')"><img alt="paste.png" src="inform:/doc_images/paste.png" /></a>  &quot;Mr. Burns' Repast&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8298_296" -->
<a id="c8298_296"></a><blockquote class="code"><p class="quoted">
Wharf is a room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8299_296" -->
<a id="c8299_296"></a><blockquote class="code"><p class="quoted">
There is an unknown fish in the Wharf. The unknown fish has some a text called the supposed name. The description of the unknown fish is &quot;The victim of heavy mutagens, this thing is not really recognizable as any species you know.&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8300_296" -->
<a id="c8300_296"></a><blockquote class="code"><p class="quoted">
Fish variety is a kind of value. The fish varieties are salmon, albacore, mackerel.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8301_296" -->
<a id="c8301_296"></a><blockquote class="code"><p class="quoted">
Rule for printing the name of the unknown fish:
<br />&#160;&#160;&#160;&#160;if the supposed name of the unknown fish is &quot;&quot;, say the printed name of the unknown fish;
<br />&#160;&#160;&#160;&#160;otherwise say the supposed name of the unknown fish.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8302_296" -->
<a id="c8302_296"></a><blockquote class="code"><p class="quoted">
After reading a command:
<br />&#160;&#160;&#160;&#160;if the unknown fish is visible and player's command matches the regular expression &quot;\b\w+fish&quot;:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let N be &quot;[the player's command]&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;replace the regular expression &quot;.*(?=\b\w+fish)&quot; in N with &quot;&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now N is &quot;[N](?)&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now the supposed name of the unknown fish is N;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;respond with doubt;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;reject the player's command;
<br />&#160;&#160;&#160;&#160;otherwise if the unknown fish is visible and the player's command includes &quot;[fish variety]&quot;:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now supposed name of the fish is &quot;[fish variety understood](?)&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;respond with doubt;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;reject the player's command.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8303_296" -->
<a id="c8303_296"></a><blockquote class="code"><p class="quoted">
To respond with doubt:
<br />&#160;&#160;&#160;&#160;say &quot;You're not [italic type]sure[roman type] you're seeing any such thing.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8304_296" -->
<a id="c8304_296"></a><blockquote class="code"><p class="quoted">
Test me with &quot;get swordfish / look / touch monkfish / look / listen to tunafish / x fish / x salmon / look&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<!-- START EXAMPLE "424: Cave-troll" "e342" -->
<a id="e342"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="#" class="eglink" onclick="showExample('example342'); return false;"><b>424</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="#" class="eglink" onclick="showExample('example342'); return false;"><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Cave-troll</span></b></a><br />Determining that the command the player typed is invalid, editing it, and re-examining it to see whether it now reads correctly.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="Rdoc45.html#e342"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example342" style="display: none;">
<p>Novice players of interactive fiction, unfamiliar with its conventions, will often try to add extra phrases to a command that the game cannot properly parse: HIT DOOR WITH FIST, for instance, instead of HIT DOOR.</p>
<p>While we can deal with some of these instances by expanding our range of actions, at some point it becomes impossible to account for all the possible prepositional phrases that the player might want to tack on. So what do we do if we want to handle those appended bits of text sensibly?</p>
<p>We could go through and remove any piece of text containing &quot;with ...&quot; from the end of a player's command; the problem with that is that it overzealously lops off the ends of valid commands like UNLOCK DOOR WITH KEY, as well. So clearly we don't want to do this as part of the &quot;After reading a command...&quot; stage.</p>
<p>A better time to cut off the offending text is right before issuing a parser error. At that point, Inform has already determined that it definitely cannot parse the instruction as given, so we know that there's something wrong with it.</p>
<p>The next problem, though, is that after we've edited the player's text we want to feed the corrected version back to Inform and try once more to interpret it.</p>
<p>This is where we have a valid reason to write a new &quot;rule for reading a command&quot;. We will tell Inform that when we have just corrected the player's input to something new, it should not ask for a new command (by printing a prompt and waiting for another line of input); it should instead paste our stored corrected command back into &quot;the player's command&quot; and proceed as though that new text had just been typed.</p>
<p>Thanks to John Clemens for the specifics of the implementation.</p>
<!-- START CODE "c8305_342" -->
<a id="c8305_342"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode('[=0x0022=]Cave-troll[=0x0022=] by JDC[=0x000A=][=0x000A=]Section 1 - The Mechanism[=0x000A=][=0x000A=]The last command is a text that varies.[=0x000A=][=0x000A=]The parser error flag is a truth state that varies. The parser error flag is false.[=0x000A=][=0x000A=]Rule for printing a parser error when the latest parser error is the only understood as far as error and the player[=0x0027=]s command matches the text [=0x0022=]with[=0x0022=]:[=0x000A=][=0x0009=]now the last command is the player[=0x0027=]s command;[=0x000A=][=0x0009=]now the parser error flag is true;[=0x000A=][=0x0009=]let n be [=0x0022=][the player[=0x0027=]s command][=0x0022=];[=0x000A=][=0x0009=]replace the regular expression [=0x0022=].* with (.*)[=0x0022=] in n with [=0x0022=]with [=0x005C=]1[=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=](ignoring the unnecessary words [=0x0027=][n][=0x0027=])[line break][=0x0022=];[=0x000A=][=0x0009=]replace the regular expression [=0x0022=]with .*[=0x0022=] in the last command with [=0x0022=][=0x0022=].[=0x000A=][=0x000A=]Rule for reading a command when the parser error flag is true:[=0x000A=][=0x0009=]now the parser error flag is false;[=0x000A=][=0x0009=]change the text of the player[=0x0027=]s command to the last command.[=0x000A=][=0x000A=]Section 2 - The Scenario[=0x000A=][=0x000A=]The Cave is a room.[=0x000A=][=0x000A=]The troll is a man in the cave.[=0x000A=][=0x000A=]The player carries a sword.[=0x000A=][=0x000A=]The chest is a locked lockable container in the cave.[=0x000A=][=0x000A=]Test me with [=0x0022=]attack troll with sword / unlock chest with sword / attack troll as a test[=0x0022=].[=0x000A=][=0x000A=]\n')"><img alt="paste.png" src="inform:/doc_images/paste.png" /></a> &quot;Cave-troll&quot; by JDC
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8306_342" -->
<a id="c8306_342"></a><blockquote class="code"><p class="quoted">
Section 1 - The Mechanism
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8307_342" -->
<a id="c8307_342"></a><blockquote class="code"><p class="quoted">
The last command is a text that varies.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8308_342" -->
<a id="c8308_342"></a><blockquote class="code"><p class="quoted">
The parser error flag is a truth state that varies. The parser error flag is false.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8309_342" -->
<a id="c8309_342"></a><blockquote class="code"><p class="quoted">
Rule for printing a parser error when the latest parser error is the only understood as far as error and the player's command matches the text &quot;with&quot;:
<br />&#160;&#160;&#160;&#160;now the last command is the player's command;
<br />&#160;&#160;&#160;&#160;now the parser error flag is true;
<br />&#160;&#160;&#160;&#160;let n be &quot;[the player's command]&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;.* with (.*)&quot; in n with &quot;with \1&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;(ignoring the unnecessary words '[n]')[line break]&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;with .*&quot; in the last command with &quot;&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8310_342" -->
<a id="c8310_342"></a><blockquote class="code"><p class="quoted">
Rule for reading a command when the parser error flag is true:
<br />&#160;&#160;&#160;&#160;now the parser error flag is false;
<br />&#160;&#160;&#160;&#160;change the text of the player's command to the last command.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8311_342" -->
<a id="c8311_342"></a><blockquote class="code"><p class="quoted">
Section 2 - The Scenario
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8312_342" -->
<a id="c8312_342"></a><blockquote class="code"><p class="quoted">
The Cave is a room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8313_342" -->
<a id="c8313_342"></a><blockquote class="code"><p class="quoted">
The troll is a man in the cave.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8314_342" -->
<a id="c8314_342"></a><blockquote class="code"><p class="quoted">
The player carries a sword.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8315_342" -->
<a id="c8315_342"></a><blockquote class="code"><p class="quoted">
The chest is a locked lockable container in the cave.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8316_342" -->
<a id="c8316_342"></a><blockquote class="code"><p class="quoted">
Test me with &quot;attack troll with sword / unlock chest with sword / attack troll as a test&quot;.
</p></blockquote>
<!-- END CODE -->
<p>A caveat about using this method in a larger game: &quot;parser error flag&quot; will not automatically control the behavior of any rules we might have written for Before reading a command... or After reading a command..., so they may now fire at inappropriate times. It is a good idea to check for parser error flag in those rules as well.</p>
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
</div>
<!-- START IGNORE -->
<div class="bookfooter">
<table class="fullwidth"><tr><td class="footerprevious"><a href="doc349.html" class="footerlink">Previous</a></td><td class="footercontents"><a href="index.html" class="footerlink">Contents</a></td><td class="footernext"><a href="doc351.html" class="footerlink">Next</a></td></tr></table>
</div>
<!-- END IGNORE -->
</body>
</html>
