<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Generated by indoc on 24 Dec 2015 -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link href="indoc_WI.css" rel="stylesheet" type="text/css" />
<title>27.30. To say one of</title>
<script type="text/javascript">
    function showExtra(id, imid) {
        if (document.getElementById(id).style.display == 'block') {
            document.getElementById(id).style.display = 'none';
            document.getElementById(imid).src = 'inform:/doc_images/extra.png';
        } else {
            document.getElementById(id).style.display = 'block';
            document.getElementById(imid).src = 'inform:/doc_images/extraclose.png';
        }
    }
    function onLoaded() {
        if (window.location.hash) {
            var hash = window.location.hash.substring(2);
            if (hash.search("_") >= 0) {
                var res = hash.split("_");
                showExample("example"+res[1]);
            } else {
                showExample("example"+hash);
            }
        }
    }
    window.onload=onLoaded;
    function showExample(id) {
        if (document.getElementById(id).style.display == 'block') {
            document.getElementById(id).style.display = 'none';
        } else {
            document.getElementById(id).style.display = 'block';
        }
    }
    function openExtra(id, imid) {
        document.getElementById(id).style.display = 'block';
        document.getElementById(imid).src = 'inform:/doc_images/extraclose.png';
    }
    function closeExtra(id, imid) {
        document.getElementById(id).style.display = 'none';
        document.getElementById(imid).src = 'inform:/doc_images/extra.png';
    }
</script>
</head>
<body class="paper papertint"><script language="JavaScript">
function pasteCode(code) {
    var myProject = window.Project;

    myProject.selectView('source');
    myProject.pasteCode(code);
}
</script>
<script language="JavaScript">
function createNewProject(code, title) {
    var myProject = window.Project;

    myProject.createNewProject(title, code);
}
</script>

<!-- SEARCH TITLE "To say one of" -->
<!-- SEARCH SECTION "27.30" -->
<!-- SEARCH SORT "000-027-030-000" -->
<!-- START IGNORE 458 -->
<div class="bookheader">
<table class="fullwidth midnightblack"><tr><td class="midnightbannerleftcell"><a href="doc458.html" class="standardlink"><img alt="Hookleft.png" src="inform:/doc_images/Hookleft.png" id="hookleft" /></a></td><td class="midnightbannercentrecell"><a href="index.html" class="standardlink"><span class="midnightbannertext">Chapter 27: Extensions</span></a></td><td class="midnightbannerrightcell"><a href="index.html" class="standardlink"><img alt="Hookup.png" src="inform:/doc_images/Hookup.png" id="hookup" /></a></td></tr></table></div>
<!-- END IGNORE -->
<p class="sectionheading">ยง27.30. To say one of</p>
<p>Many of the invocation syntaxes described in the previous section are used in the definition by the Standard Rules of the &quot;[one of] ... [or] ... [purely at random]&quot; construction, so it makes a good example of how they can be used.</p>
<p>First, this is a segmented substitution with a single possible beginning (&quot;[one of]&quot;), a single possible middle (&quot;[or]&quot;) but a choice of many possible endings. Almost everything is compiled by the invocation of the beginning:</p>
<!-- START CODE "c9269" -->
<a id="c9269"></a><blockquote class="code"><p class="quoted">
To say one of -- beginning say_one_of (documented at phs_oneof): (-
<br />&#160;&#160;&#160;&#160;{-counter-makes-array:say_one_of}
<br />&#160;&#160;&#160;&#160;{-counter-makes-array:say_one_flag}
<br />&#160;&#160;&#160;&#160;if (I7_ST_say_one_flag--&gt;{-counter:say_one_flag} == false) {
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;I7_ST_say_one_of--&gt;{-counter:say_one_of} = {-final-segment-marker}(I7_ST_say_one_of--&gt;{-counter:say_one_of},
<br />{-segment-count});
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;I7_ST_say_one_flag--&gt;{-counter:say_one_flag} = true;
<br />&#160;&#160;&#160;&#160;}
<br />&#160;&#160;&#160;&#160;if (say__comp == false) I7_ST_say_one_flag--&gt;{-counter:say_one_flag}{-counter-up:say_one_flag} =
<br />false;
<br />&#160;&#160;&#160;&#160;switch ((I7_ST_say_one_of--&gt;{-counter:say_one_of}{-counter-up:say_one_of})%({-segment-count}+1)-1)
<br />{-open-brace}
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0: -).
<br />To say or -- continuing say_one_of (documented at phs_or):
<br />&#160;&#160;&#160;&#160;(- @nop; {-segment-count}: -).
<br />To say purely at random -- ending say_one_of with marker I7_SOO_PAR (documented at phs_purelyrandom):
<br />&#160;&#160;&#160;&#160;(- {-close-brace} -).
</p></blockquote>
<!-- END CODE -->
<p>The 3rd invocation of this (say) might compile the following:</p>
<!-- START CODE "c9270" -->
<a id="c9270"></a><blockquote class="code"><p class="quoted">
I7_ST_say_one_of--&gt;2 = I7_SOO_PAR(I7_ST_say_one_of--&gt;2, 4);
<br />switch((I7_ST_say_one_of--&gt;2)%5 - 1) {
<br />&#160;&#160;&#160;&#160;0: ... first text ...
<br />&#160;&#160;&#160;&#160;1: ... second text ...
<br />&#160;&#160;&#160;&#160;2: ... third text ...
<br />&#160;&#160;&#160;&#160;3: ... fourth text ...
<br />}
</p></blockquote>
<!-- END CODE -->
<p>First, we notified Inform that it needs to allocate an array (I7_ST_say_one_of) providing storage associated with the counter &quot;say_one_of&quot;. This we used to count off individual invocations of &quot;[one of]&quot;, so that each would have its own word of storage - for the 3rd invocation, I7_ST_say_one_of--&gt;2. We then call a state-changing routine, in this case I7_SOO_PAR, which is allowed to know the previous state and also the number of options available, and which returns the new state. The state is supposed to be the option chosen last time, but that means that there are not 4, but 5 possibilities: 0 for &quot;there was no last time&quot;, then 1 to 4 for the possible outcomes. We reduce the state mod 5 to obtain the decision this time, and subtract 1 because it happens to be convenient to make the switch statement run from 0 to 3 rather than 1 to 4. (The reason we reduce the state mod 5 is to allow the state-changer to squirrel away secret information in the upper bits of the state, if it wants to. Note that subtracting one means that the switch value might be -1, which results in no text being printed: thus if the state-changer chooses 0, it can decide on none of the above.)</p>
<p>In this design, the marker attached to the choice of ending substitution is the name of the I6 state-changer: here is the I7_SOO_PAR routine.</p>
<!-- START CODE "c9271" -->
<a id="c9271"></a><blockquote class="code"><p class="quoted">
[ I7_SOO_PAR oldval count; if (count &lt;= 1) return count; return random(count); ];
</p></blockquote>
<!-- END CODE -->
<p>As it happens, this ignores the old value: after all, it is meant to be purely at random, and nothing could be less pure than taking the last outcome into consideration when choosing the next.</p>
<p>Note that the counter say_one_of is advanced in invocation of the head. It might seem that the tidier design, somehow, would be to advance the counter in the invocation of the tails, but this is not a good idea. In general it is not safe to assume that the counter will have the same value when the tail is invoked that it had when the head was invoked, because segmented say constructions can legally be nested in Inform strings. Because of this, it is best to deal with a counter entirely in a single invocation, either of the beginning or the ending.</p>
<p>Because &quot;[one of] ... [or] ...&quot; is such a useful construction - switching between alternative forms of text, which writers of IF very often do - the above implementation is intentionally left open for new endings to be added, and the examples below show how easily this can be done.</p>
<hr />
<div class="bookexamples">
<p class="chapterheading"></p><!-- START EXAMPLE "454: Blink" "e163" -->
<a id="e163"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="#" class="eglink" onclick="showExample('example163'); return false;"><b>454</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="#" class="eglink" onclick="showExample('example163'); return false;"><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Blink</span></b></a><br />Making a "by atmosphere" token, allowing us to design our own text variations such as "[one of]normal[or]gloomy[or]scary[by atmosphere]".</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="Rdoc5.html#e163"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example163" style="display: none;">
<p>Suppose we are writing a game in which the mood of the piece changes, and we would like to have lots of descriptions that vary according to its current state. We might in that case want to create our own &quot;by atmosphere&quot; token, to control text variations, like this:</p>
<!-- START CODE "c9272_163" -->
<a id="c9272_163"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode('[=0x0022=]Blink[=0x0022=][=0x000A=][=0x000A=]Atmosphere is a kind of value. The atmospheres are normal, melancholy, and creepy.[=0x000A=][=0x000A=]The current atmosphere is an atmosphere that varies.[=0x000A=][=0x000A=]To say by atmosphere -- ending say_one_of with marker I7_SOO_ATM:[=0x000A=][=0x0009=](- {-close-brace} -).[=0x000A=][=0x000A=][Since we[=0x0027=]re operating within the untyped Inform 6, we can make use of the fact that kinds of value are (internally) just constants, enumerated in the same order in which they were originally defined. In other words, [=0x0022=]normal[=0x0022=] at the I6 level translates to 1, [=0x0022=]melancholy[=0x0022=] to 2, and [=0x0022=]creepy[=0x0022=] to 3; so we can return the value of the current atmosphere, and thereby select option 1, 2, or 3:][=0x000A=][=0x000A=]Include (-[=0x000A=][ I7_SOO_ATM oldval count;[=0x000A=][=0x0009=]if (count [=0x003C=] (+ current atmosphere +)) return count;[=0x000A=][=0x0009=]return (+ current atmosphere +); ];[=0x000A=]-)[=0x000A=][=0x000A=][And that concludes the hard part. Now to test that it works:][=0x000A=][=0x000A=]The Flat is a room. [=0x0022=]A small [one of]but cozy[or]depressing[or]imprisoning[by atmosphere] flat. Outside the window, the sun is [one of][or][or]apparently [by atmosphere]shining and there is a brisk breeze through the leaves of the birch trees. [one of]It would be quite nice weather for a walk[or]The rest of the world apparently has no appreciation of what you suffer[or]It all looks deceptively normal[by atmosphere].[=0x0022=][=0x000A=][=0x000A=]Instead of waiting when the current atmosphere is normal:[=0x000A=][=0x0009=]say [=0x0022=]Everything stretches wide and flat for just a moment, as though all the world around you were painted on a thin rubber sheet that is being [italic type]stretched[roman type]. Then it snaps back into place, leaving your ears ringing. But that little glitch was enough to warn you. Someone is tampering with space-time again. Someone very close by.[=0x0022=];[=0x000A=][=0x0009=]now the current atmosphere is creepy.[=0x000A=][=0x000A=]Test me with [=0x0022=]look / z / look[=0x0022=].[=0x000A=][=0x000A=]\n')"><img alt="paste.png" src="inform:/doc_images/paste.png" /></a> &quot;Blink&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c9273_163" -->
<a id="c9273_163"></a><blockquote class="code"><p class="quoted">
Atmosphere is a kind of value. The atmospheres are normal, melancholy, and creepy.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c9274_163" -->
<a id="c9274_163"></a><blockquote class="code"><p class="quoted">
The current atmosphere is an atmosphere that varies.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c9275_163" -->
<a id="c9275_163"></a><blockquote class="code"><p class="quoted">
To say by atmosphere -- ending say_one_of with marker I7_SOO_ATM:
<br />&#160;&#160;&#160;&#160;(- {-close-brace} -).
</p></blockquote>
<!-- END CODE -->
<p>Since we're operating within the untyped Inform 6, we can make use of the fact that kinds of value are (internally) just constants, enumerated in the same order in which they were originally defined. In other words, &quot;normal&quot; at the I6 level translates to 1, &quot;melancholy&quot; to 2, and &quot;creepy&quot; to 3; so we can return the value of the current atmosphere, and thereby select option 1, 2, or 3:</p>
<!-- START CODE "c9276_163" -->
<a id="c9276_163"></a><blockquote class="code"><p class="quoted">
Include (-
<br />[ I7_SOO_ATM oldval count;
<br />&#160;&#160;&#160;&#160;if (count &lt; (+ current atmosphere +)) return count;
<br />&#160;&#160;&#160;&#160;return (+ current atmosphere +); ];
<br />-)
</p></blockquote>
<!-- END CODE -->
<p>And that concludes the hard part. Now to test that it works:</p>
<!-- START CODE "c9277_163" -->
<a id="c9277_163"></a><blockquote class="code"><p class="quoted">
The Flat is a room. &quot;A small [one of]but cozy[or]depressing[or]imprisoning[by atmosphere] flat. Outside the window, the sun is [one of][or][or]apparently [by atmosphere]shining and there is a brisk breeze through the leaves of the birch trees. [one of]It would be quite nice weather for a walk[or]The rest of the world apparently has no appreciation of what you suffer[or]It all looks deceptively normal[by atmosphere].&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c9278_163" -->
<a id="c9278_163"></a><blockquote class="code"><p class="quoted">
Instead of waiting when the current atmosphere is normal:
<br />&#160;&#160;&#160;&#160;say &quot;Everything stretches wide and flat for just a moment, as though all the world around you were painted on a thin rubber sheet that is being [italic type]stretched[roman type]. Then it snaps back into place, leaving your ears ringing. But that little glitch was enough to warn you. Someone is tampering with space-time again. Someone very close by.&quot;;
<br />&#160;&#160;&#160;&#160;now the current atmosphere is creepy.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c9279_163" -->
<a id="c9279_163"></a><blockquote class="code"><p class="quoted">
Test me with &quot;look / z / look&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<!-- START EXAMPLE "455: Uncommon Ground" "e189" -->
<a id="e189"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="#" class="eglink" onclick="showExample('example189'); return false;"><b>455</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="#" class="eglink" onclick="showExample('example189'); return false;"><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Uncommon Ground</span></b></a><br />Making a "by viewpoint" token, allowing us to design our own text variations such as "[show to yourself]quaint[to Lolita]thrilling[to everyone else]squalid[end show]" depending on the identity of the player at the moment.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="Rdoc28.html#e189"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example189" style="display: none;">
<p>A slightly more challenging case than the &quot;by atmosphere&quot; example is one in which we want to create text variations depending on the identity of our player character.</p>
<p>What we want to do is build a switch statement in I6, one that looks something like</p>
<!-- START CODE "c9280_189" -->
<a id="c9280_189"></a><blockquote class="code"><p class="quoted">
switch(player)
<br />{
<br />&#160;&#160;&#160;&#160;yourself: print &quot;quaint&quot;;
<br />&#160;&#160;&#160;&#160;Lolita: print &quot;thrilling&quot;;
<br />&#160;&#160;&#160;&#160;default: print &quot;squalid&quot;;
<br />}
</p></blockquote>
<!-- END CODE -->
<p>out of I7 that looks like this:</p>
<!-- START CODE "c9281_189" -->
<a id="c9281_189"></a><blockquote class="code"><p class="quoted">
say &quot;[show to yourself]quaint[to Lolita]thrilling[to everyone else]squalid[end show]&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c9282_189" -->
<a id="c9282_189"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode('[=0x0022=]Uncommon Ground[=0x0022=][=0x000A=][=0x000A=]The Mud Village is a room. [=0x0022=]You stand at the center of a [show to yourself]quaint[to Lolita]thrilling[to everyone else]squalid[end show] mud village.[=0x0022=][=0x000A=][=0x000A=]Leforge is a man in the Mud Village. Lolita is a woman in the Mud Village.[=0x000A=][=0x000A=]Instead of waiting:[=0x000A=][=0x0009=]if the player is Lolita, now the player is Leforge;[=0x000A=][=0x0009=]if the player is yourself, now the player is Lolita;[=0x000A=][=0x0009=]say [=0x0022=]You jump bodies. Whoops![=0x0022=][=0x000A=][=0x000A=]To say show to (N - a person) -- beginning say_seen_by:[=0x000A=][=0x0009=](-[=0x000A=][=0x0009=][=0x0009=]switch(player)[=0x000A=][=0x0009=][=0x0009=]{-open-brace}[=0x000A=][=0x0009=][=0x0009=]{N}:[=0x000A=][=0x0009=]-).[=0x000A=][=0x000A=]To say to (N - a person) -- continuing say_seen_by:[=0x000A=][=0x0009=](-[=0x000A=][=0x0009=][=0x0009=]{N}:[=0x000A=][=0x0009=]-).[=0x000A=][=0x000A=]To say to everyone else -- continuing say_seen_by:[=0x000A=][=0x0009=](-[=0x000A=][=0x0009=][=0x0009=]default:[=0x000A=][=0x0009=]-)[=0x000A=][=0x000A=]To say end show -- ending say_seen_by:[=0x000A=][=0x0009=](-[=0x000A=][=0x0009=][=0x0009=]{-close-brace}[=0x000A=][=0x0009=]-)[=0x000A=][=0x000A=]Test me with [=0x0022=]look / z / look / z / look[=0x0022=].[=0x000A=]\n')"><img alt="paste.png" src="inform:/doc_images/paste.png" /></a> &quot;Uncommon Ground&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c9283_189" -->
<a id="c9283_189"></a><blockquote class="code"><p class="quoted">
The Mud Village is a room. &quot;You stand at the center of a [show to yourself]quaint[to Lolita]thrilling[to everyone else]squalid[end show] mud village.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c9284_189" -->
<a id="c9284_189"></a><blockquote class="code"><p class="quoted">
Leforge is a man in the Mud Village. Lolita is a woman in the Mud Village.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c9285_189" -->
<a id="c9285_189"></a><blockquote class="code"><p class="quoted">
Instead of waiting:
<br />&#160;&#160;&#160;&#160;if the player is Lolita, now the player is Leforge;
<br />&#160;&#160;&#160;&#160;if the player is yourself, now the player is Lolita;
<br />&#160;&#160;&#160;&#160;say &quot;You jump bodies. Whoops!&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c9286_189" -->
<a id="c9286_189"></a><blockquote class="code"><p class="quoted">
To say show to (N - a person) -- beginning say_seen_by:
<br />&#160;&#160;&#160;&#160;(-
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;switch(player)
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{-open-brace}
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{N}:
<br />&#160;&#160;&#160;&#160;-).
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c9287_189" -->
<a id="c9287_189"></a><blockquote class="code"><p class="quoted">
To say to (N - a person) -- continuing say_seen_by:
<br />&#160;&#160;&#160;&#160;(-
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{N}:
<br />&#160;&#160;&#160;&#160;-).
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c9288_189" -->
<a id="c9288_189"></a><blockquote class="code"><p class="quoted">
To say to everyone else -- continuing say_seen_by:
<br />&#160;&#160;&#160;&#160;(-
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;default:
<br />&#160;&#160;&#160;&#160;-)
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c9289_189" -->
<a id="c9289_189"></a><blockquote class="code"><p class="quoted">
To say end show -- ending say_seen_by:
<br />&#160;&#160;&#160;&#160;(-
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{-close-brace}
<br />&#160;&#160;&#160;&#160;-)
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c9290_189" -->
<a id="c9290_189"></a><blockquote class="code"><p class="quoted">
Test me with &quot;look / z / look / z / look&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
</div>
<!-- START IGNORE -->
<div class="bookfooter">
<table class="fullwidth"><tr><td class="footerprevious"><a href="doc458.html" class="footerlink">Previous</a></td><td class="footercontents"><a href="index.html" class="footerlink">Contents</a></td><td class="footernext"><span class="footernonlink">End</span></td></tr></table>
</div>
<!-- END IGNORE -->
</body>
</html>
